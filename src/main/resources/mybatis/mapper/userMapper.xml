<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.woojungcard.woojungcard.repository.UserRepository">
    <select id="findById" resultType="com.woojungcard.woojungcard.domain.dto.UserDTO">
    	<![CDATA[
        select * from user
        ]]>
    </select>
    
    <!-- 아이디 중복 체크 -->
    <select id="userIdCheck" resultType="int" parameterType="com.woojungcard.woojungcard.domain.request.UserIdCheckRequest">
    	<![CDATA[
    	SELECT
    		count(*)
   		FROM
   			user
  		WHERE
  			user_id = #{userId}
 		]]>
    </select>
       
    <!-- 유저 회원가입 -->
    <insert id="userSignUp" parameterType="com.woojungcard.woojungcard.domain.request.UserSignUpRequest">
    	<![CDATA[
   		INSERT INTO 
   			user(user_id, user_pwd, user_name, user_birth, user_gender, user_tel, user_join_date)
   		VALUES
   			(#{userId}, #{userPwd}, #{userName}, #{userBirth}, #{userGender}, #{userTel}, now()) 
    	]]>
    </insert>
    
    <!-- 유저 로그인 -->
    <select id="userLogin" resultType="com.woojungcard.woojungcard.domain.dto.UserDTO" parameterType="com.woojungcard.woojungcard.domain.request.UserLoginRequest">
    	<![CDATA[
    	SELECT
    		*
    	FROM
    		user
    	WHERE
    		user_id = #{userId} AND user_pwd = #{userPwd}	
    	]]>
    </select>
    
    <!-- 유저 정보 조회 -->
    <select id="userGetInfo" resultType="com.woojungcard.woojungcard.domain.response.UserInfoResponse" parameterType="Long">
    	<![CDATA[
    	SELECT
    		user_id, user_name, user_birth, user_tel
    	FROM
    		user
    	WHERE
    		id = #{id}
    	]]>
    </select>
    
    <!-- 유저 아이디 조회 -->
    <select id="findUserIdById" resultType="String" parameterType="Long">
    	<![CDATA[
    	SELECT
    		user_id
    	FROM
    		user
   		WHERE
   			id = #{id}
    	]]>
    </select>
    
    <!-- 유저 정보 변경 -->
    <update id="userInfoUpdate" parameterType="com.woojungcard.woojungcard.domain.request.UserInfoUpdateRequest">
    	<![CDATA[
    	UPDATE
    		user
   		SET
   			user_pwd = #{userPwd}, user_tel = #{userTel}
   		WHERE
   			id = #{id} 
    	]]>
    </update>
    
    <!-- 유저 카드 등록 정보 조회 -->
    <select id="userCardAppInfo" resultType="com.woojungcard.woojungcard.domain.response.UserCardAppInfoResponse" parameterType="Long">
    	<![CDATA[
    	SELECT
    		user_name, user_birth, user_tel
   		FROM
   			user
  		WHERE
  			id = #{id}
    	]]>
    </select>
    
    <!-- 유저 카드 신청 현황 조회 -->
    <select id="userCardAppStatus" resultType="com.woojungcard.woojungcard.domain.response.CardApplicationResponse" parameterType="Long">
    	<![CDATA[
    	SELECT 
    		card_number, 
    		card_name, 
    		card_type, 
    		request_date, 
    		expiration_date 
   		FROM  
   			card_issued AS i 
 		INNER JOIN 
 			card_product AS p 
 		ON 
 			i.card_id = p.id 
 		WHERE 
 			user_id = #{id}
 		AND 
 			(expiration_date <= now()+7 OR expiration_date is null)
		]]>
    </select>

    <!-- Get User List -->
    <select id="userList" resultType="com.woojungcard.woojungcard.domain.dto.UserDTO">
    	<![CDATA[
    	SELECT
    		*
    	FROM
    		user
    	]]>
    </select>
</mapper>
